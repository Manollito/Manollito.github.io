---
title: "Visualización de información sobre el covid"
---

**Autores:** Manuel de Jesús Calero Ríos y Harlen Daniel Quirós Gómez

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library (ggplot2)
library(dplyr)
library(readxl)
library(plotly)
library(tidyr)
library(lubridate)

covid <- read_excel("CasosCOVID.xlsx", sheet = "1_GENERAL")
covid_provincias <- read_excel("CasosCOVID.xlsx", sheet = "2_4 CANT_ACTIVOS")
covid2 <- read_excel("CasosCOVID.xlsx", sheet = "2_5 CANT_NUEVOS")
covid_provincias <- covid_provincias %>%
  pivot_longer(names_to='fecha',
               cols = starts_with("4")) %>%
  mutate(fecha = as.Date(as.numeric(fecha), origin = "1900-01-01" )) %>%
  group_by(provincia, fecha) %>%
  summarise(casos = sum(value)) %>%
  mutate(anio = year(fecha)) %>%
  filter( provincia != 'Otros')
```
# Gráficas unidimensionales 
```{r}
covid_no_acumulado <- covid %>%
  mutate(
    anterior_dia_hombre = lag(hom_posi),
    anterior_dia_mujer = lag(muj_posi),
    muj_posi_no_acumulado = muj_posi - anterior_dia_mujer,
    homb_posi_no_acumulado = hom_posi - anterior_dia_hombre,    
  ) %>%
  select(FECHA, muj_posi, anterior_dia_mujer, muj_posi_no_acumulado, hom_posi, anterior_dia_hombre, homb_posi_no_acumulado, everything())
```

```{r}
p <- ggplot(covid, aes(nue_posi)) + geom_histogram(binwidth=100 , fill = "red")+ 
  labs(
    x = "Cantidad de casos de covid", 
    y = "Cantidad de dias", 
    title = "Casos nuevos covid") +
  scale_x_continuous(breaks=seq( 0, max(covid$nue_posi), by=500) ) +
  theme_classic()
ggplotly(p)
```

En las gráfica anterior se puede observar que la mayoría de días hubo muy pocos casos activos nuevos, y el dia que hubo aproximadamente 7000 casos fue solo uno. Esto da como indicio que el covid se fue esparciendo poco a poco y que muy pocos días hubo picos altos de contagio, causando así que el virus se mantuviera controlado.

```{r}
p <- ggplot(covid_no_acumulado, aes(muj_posi_no_acumulado)) + geom_histogram(binwidth=100, fill = "#F33A6A")+ 
  labs(
    x = "Cantidad casos de covid: Mujeres", 
    y = "Cantidad de dias", 
    title = "Casos nuevos de covid en mujeres") +
  scale_x_continuous(breaks=seq( 0, max(covid$nue_posi), by=500) ) +
  theme_classic()
ggplotly(p)
```
En la gráfica anterior se observa de igual manera que hubo muchos días donde hubo nuevos contagios de mujeres con covid, sí hubo picos de casos, pero fueron muy pocos días, por lo que el covid en los hombres no se vio muy disparado y siempre fue creciendo de manera uniforme.

```{r}
p <- ggplot(covid_no_acumulado, aes(homb_posi_no_acumulado)) + geom_histogram(binwidth=100, fill = "blue")+ 
  labs(
    x = "Cantidad casos de covid: Hombres", 
    y = "Cantidad de dias", 
    title = "Casos nuevos de covid en hombres") +
  scale_x_continuous(breaks=seq( 0, max(covid$nue_posi), by=500) ) +
  theme_classic()
ggplotly(p)
```

En la gráfica anterior se observa de igual manera que hubo muchos días donde hubo nuevos contagios de mujeres con covid, sí hubo picos de casos, pero fueron muy pocos días, por lo que el covid en los hombres no se vio muy disparado y siempre fue creciendo de manera uniforme. En comparación con las mujeres, estas tienen el pico más alto de nuevos contagios de covid, con casi 4000, mientras el dia en pico más alto de hombres fue de casi 3400.

# Gráficas bidimensionales

```{r}
covid_edad <- covid %>%
  mutate(
    ant_dia_adul = lag(adul_posi),
    ant_dia_am = lag(am_posi),
    ant_dia_menor = lag(menor_posi),
    `Adultos fallecidos` = adul_posi - ant_dia_adul,
    `Adultos mayores fallecidos`  = am_posi - ant_dia_am,
    `Menores fallecidos`  = menor_posi - ant_dia_menor
  ) %>%
  select(`Menores fallecidos`, `Adultos fallecidos`, `Adultos mayores fallecidos`, FECHA) %>%
  pivot_longer(names_to='edad',
               cols = c('Menores fallecidos',  'Adultos fallecidos',	'Adultos mayores fallecidos')
) %>%
  filter(!is.na(value))

```

```{r}
p <- ggplot(covid_edad, aes(edad, value)) + geom_violin(fill = "green") + 
  labs(
    x = "Categoria de edad", 
    y = "Cantidad de casos", 
    title = "Cantidad de casos fallecidos por categoría de edad"
  ) +
  scale_y_continuous(breaks=seq( 0, max(covid_edad$value), by=500) ) +
  theme_classic()
ggplotly(p)
```

Hubo muchos dias con pocas muertes en niños y adultos mayores, pero los adultos tuvieron días con muchos más muertes, aunque estos fueron pocos, por eso la gráfica se ve tan punteada. En los adultos hubo más dias con pocos muertos, por eso se ve tan ancha en la base, en los niños si hubo días con más muertos, aunque esto se ve uniforme.

```{r}
covid_muertos <- covid %>%
  mutate(
    ant_dia_hom_fall = lag(hom_fall),
    ant_dia_muj_fall = lag(muj_fall),
    `hombres fallecidos` = hom_fall - ant_dia_hom_fall,
    `mujeres fallecidas` = muj_fall - ant_dia_muj_fall
  ) %>%
  select(`hombres fallecidos`, `mujeres fallecidas`, FECHA) %>%
  pivot_longer(names_to='fallecidos',
               cols = c('hombres fallecidos',  'mujeres fallecidas')
) %>%
  filter(!is.na(value), value>=0)
```

```{r}
p <- ggplot(covid_muertos, aes(fallecidos, value)) + geom_boxplot() + 
  labs(
    x = "Sexo de los fallecidos", 
    y = "Cantidad de fallecidos", 
    title = "Cantidad de fallecidos por sexo"
  ) +
  scale_y_continuous(breaks=seq( 0, max(covid_edad$value), by=500) ) +
  theme_classic()
ggplotly(p)
```

En ambos gráficos se puede ver que hay días donde levemente hubo más hombres fallecidos que mujeres. Hubieron días que no hubo muertes. La caja de los hombres se observa un poco más larga, lo que quiere decir que la dispersión de cantidad de fallecidos por día es mayor en los hombres.

```{r}
p <- ggplot(covid_provincias, aes(fecha, casos, color = as.factor(anio))) + 
  geom_line() + 
  labs(
    x = ""
  )+
  facet_grid(provincia ~ anio, scales = "free_x")+
  theme_minimal() +
  scale_color_manual(values = c("2020" = "red", "2021" = "blue", "2022" = "green"))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
ggplotly(p)
```
En la gráfica anterior se observa como la provincia con mayor cntidad de picos es San José, especialmente en el año 2022, que es el año donde se ve más pronunciado. Limón, Puntarenas y Guanacaste son las provincias con la menor cantidad de casos, estos no tuvieron picos y la propagación fue muy uniforme.El comportamiento de Alajuela es más pronunciado en el 2021 y 2022, por lo que al principio de la pandemia hubo menos casos y conforme fue avanzando se dieron más. Cartago y Heredia son provincias donde este compórtamiento estuvo muy parecido, tienen picos, pero no muy extensos, y se ve muy uniforme la propagación. Las provincias costeras se dieron menos casos, pero en GAM hubo más, por lo que se puede dar una relación bastante curiosa.

```{r}

```

# Gráfica multidimensional

```{r}
covid_2021 <- covid2 %>%
  select(cod_provin, provincia, cod_canton, canton, starts_with("2021"))
head(covid2)
# Suma de casos totales por provincia
casos_totales_2021 <- rowSums(covid_2021[, -(1:4)])

# Crear un dataframe con las provincias y sus casos totales
datos_grafico_2021 <- data.frame(provincia = covid_2021$provincia, casos_totales = casos_totales_2021)

# Ordenar los datos de mayor a menor según los casos totales
datos_grafico_2021 <- datos_grafico_2021[order(-datos_grafico_2021$casos_totales), ]

# Crear el gráfico de barras
barplot(height = datos_grafico_2021$casos_totales,
        names.arg = datos_grafico_2021$provincia,
        las = 2,  # Orientación de etiquetas en el eje x
        main = "Casos totales de COVID por provincia en 2021",
        xlab = "Provincia",
        ylab = "Casos totales de COVID")
```
